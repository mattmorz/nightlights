/* --- GLOBAL DARK THEME --- */
body, html {
  margin: 0; padding: 0; height: 100%; background-color: #0d1117; font-family: 'Segoe UI', sans-serif; color: #e6edf3; overflow: hidden;
}
.app-container { height: 100vh; display: flex; flex-direction: column; }

/* --- HEADER --- */
.app-header {
  background: rgba(13, 17, 23, 0.85); backdrop-filter: blur(10px); padding: 1rem; text-align: center; border-bottom: 1px solid #30363d; z-index: 1000; position: absolute; width: 100%; box-shadow: 0 4px 30px rgba(0, 0, 0, 0.5); pointer-events: none;
}
.app-header * { pointer-events: auto; }
.app-header h1 {
  margin: 0; font-size: 1.5rem; letter-spacing: 2px; text-transform: uppercase; background: linear-gradient(90deg, #fff, #aaa); -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.app-header p { margin: 5px 0 0; font-size: 0.9rem; color: #8b949e; }
.map-view { flex-grow: 1; height: 100%; width: 100%; background-color: #0d1117; }
.leaflet-div-icon { background: transparent; border: none; }

/* --- BEACON PHYSICS --- */
.beacon-core { width: 100%; height: 100%; border-radius: 50%; position: relative; will-change: transform, opacity, box-shadow; }

/* GROUND GLOW EFFECT */
.beacon-positive::before,
.beacon-healed::before {
  content: '';
  position: absolute;
  top: 50%; left: 50%;
  transform: translate(-50%, -50%);
  
  /* Dynamic size from JS */
  width: var(--glow-diameter, 0px); 
  height: var(--glow-diameter, 0px);
  
  border-radius: 50%; z-index: -1; pointer-events: none; 
  mix-blend-mode: screen; /* Illuminates the dark tiles */
  transition: width 0.3s ease, height 0.3s ease;
}

/* 1. Positive */
.beacon-positive {
  background: radial-gradient(circle at center, #fff 10%, #ffdd00 40%, #ff8c00 100%);
  box-shadow: 0 0 10px 2px rgba(255, 140, 0, 0.8), 0 0 20px 5px rgba(255, 140, 0, 0.4);
  animation: lamp-flicker 4s infinite;
}
.beacon-positive::before {
  background: radial-gradient(circle, rgba(255, 160, 0, 0.35) 0%, rgba(0,0,0,0) 60%);
  animation: light-cast-flicker 4s infinite;
}

/* 2. Distressed */
.beacon-distressed {
  background: radial-gradient(circle at center, #c2f0ff 10%, #00aaff 100%);
  box-shadow: 0 0 10px 2px rgba(0, 170, 255, 0.8), 0 0 20px 5px rgba(0, 170, 255, 0.4);
  animation: breathe-blue 5s infinite ease-in-out;
}

/* 3. Healed */
.beacon-healed {
  background: radial-gradient(circle at center, #ffffff 40%, #00ffff 100%);
  box-shadow: 0 0 10px 2px rgba(0, 255, 255, 0.9), 0 0 20px 5px rgba(0, 255, 255, 0.5);
  animation: radiate-healed 4s infinite alternate;
}
.beacon-healed::before {
  background: radial-gradient(circle, rgba(0, 255, 255, 0.3) 0%, rgba(0,0,0,0) 70%);
}

/* Animations */
@keyframes lamp-flicker { 0% { opacity: 0.9; transform: scale(1); } 5% { opacity: 0.7; transform: scale(0.95); } 10% { opacity: 1; transform: scale(1.05); } 50% { opacity: 0.8; transform: scale(0.98); } 100% { opacity: 0.9; transform: scale(1); } }
@keyframes light-cast-flicker { 0% { opacity: 0.35; transform: translate(-50%, -50%) scale(1); } 5% { opacity: 0.25; transform: translate(-50%, -50%) scale(0.98); } 10% { opacity: 0.40; transform: translate(-50%, -50%) scale(1.02); } 50% { opacity: 0.30; transform: translate(-50%, -50%) scale(1); } 100% { opacity: 0.35; transform: translate(-50%, -50%) scale(1); } }
@keyframes breathe-blue { 0%, 100% { opacity: 0.7; transform: scale(0.95); } 50% { opacity: 1; transform: scale(1.05); } }
@keyframes radiate-healed { from { transform: scale(0.95); box-shadow: 0 0 10px 2px rgba(0,255,255,0.8); } to { transform: scale(1.05); box-shadow: 0 0 20px 8px rgba(0,255,255,0.6); } }

/* --- CONTROLS --- */
.map-overlay-btn {
  position: absolute; z-index: 1000; background: #222; color: #fff; border: 1px solid #444; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; font-size: 1.2em; box-shadow: 0 4px 10px rgba(0,0,0,0.5); transition: all 0.2s ease;
}
.map-overlay-btn:hover { background: #fff; color: #000; transform: scale(1.1); }
.info-btn { top: 80px; right: 20px; }
.stats-btn { top: 130px; right: 20px; }

/* --- MODALS --- */
.modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; z-index: 9999; }
.modal-content { background: #161b22; color: #c9d1d9; padding: 2rem; border-radius: 12px; width: 90%; max-width: 400px; border: 1px solid #30363d; box-shadow: 0 0 50px rgba(0,0,0,0.8); text-align: center; }
.about-content { text-align: left; line-height: 1.6; }
.about-section { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #333; }
.legend-item { display: flex; align-items: center; margin: 10px 0; }
.legend-dot { width: 15px; height: 15px; border-radius: 50%; margin-right: 10px; display: inline-block; }
.l-blue { background: #0044ff; box-shadow: 0 0 5px #0044ff; }
.l-yellow { background: #ffd700; box-shadow: 0 0 5px #ffd700; }
.l-star { background: cyan; box-shadow: 0 0 5px cyan; }

/* STATS GRID */
.stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
.stat-card { background: #0d1117; padding: 15px; border-radius: 8px; border: 1px solid #30363d; display: flex; flex-direction: column; align-items: center; justify-content: center; }
.full-width { grid-column: span 2; }
.stat-value { font-size: 2rem; font-weight: bold; }
.stat-label { font-size: 0.85rem; color: #8b949e; margin-top: 5px; text-transform: uppercase; letter-spacing: 1px; }
.text-blue { color: #00aaff; text-shadow: 0 0 10px rgba(0, 170, 255, 0.4); }
.text-yellow { color: #ffdd00; text-shadow: 0 0 10px rgba(255, 221, 0, 0.4); }
.text-cyan { color: #00ffff; text-shadow: 0 0 10px rgba(0, 255, 255, 0.4); }
.stat-footer { font-size: 0.9rem; color: #8b949e; margin-bottom: 20px; border-top: 1px solid #30363d; padding-top: 15px; }

/* FORM & BUTTONS */
textarea { width: 90%; height: 100px; margin-top: 15px; padding: 15px; background: #0d1117; color: white; border: 1px solid #30363d; border-radius: 8px; resize: none; font-family: inherit; }
textarea:focus { outline: 1px solid #00aaff; }
.modal-actions { margin-top: 10px; display: flex; justify-content: space-between; gap: 10px; }
button { flex: 1; padding: 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.2s; }
.btn-cancel { background-color: #21262d; color: #c9d1d9; border: 1px solid #30363d; }
.btn-cancel:hover { background-color: #30363d; }
.btn-submit { background-color: #238636; color: white; box-shadow: 0 0 10px rgba(35, 134, 54, 0.4); }
.btn-submit:hover { background-color: #2ea043; box-shadow: 0 0 20px rgba(35, 134, 54, 0.6); }
.comfort-mode { border-left: 4px solid #00d2ff; }
.ai-message { font-style: italic; font-size: 1.1rem; color: #a5d6ff; margin: 20px 0; line-height: 1.6; }

/* POPUPS */
.leaflet-popup-content-wrapper { background: #161b22; color: #c9d1d9; border-radius: 8px; border: 1px solid #30363d; }
.leaflet-popup-tip { background: #161b22; }
.popup-inner strong { display: block; margin-bottom: 5px; font-size: 1.1em; }
.healing-progress { margin-top: 10px; background: #21262d; padding: 8px; border-radius: 5px; }
.candle-bar { font-size: 1.2rem; margin: 5px 0; letter-spacing: 2px; }